<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Connexion Popup</title>
  <link rel="stylesheet" href="main.css" />
</head>
<body>
  
  <div class="Barre_task" >
    <button class="buton_se_connecter" onclick="open_popup_se_connecter()">Se connecter</button>
    <button class="Home_button" onclick="open_div_Home()">Home</button>
    <button class="buton_Moyen" onclick="open_popup_Moyen()">Moyen</button>
  </div>

  <!-- Overlay pour fond sombre -->
  <div id="overlay"></div>

  <!-- FenÃªtre popup connexion -->
  <div class="popup_se_connecter" id="popup_se_connecter" style="display:none;">
    <p class="decors1">__</p>
    <h2 class="h2_connexion">Connexion</h2>
    <p class="Inserez_votre_identifiants">InsÃ©rez votre identifiant</p>
    <input type="text" class="input_id" id="input_id" />
    <p class="Inserez_votre_mp">InsÃ©rez votre mot de passe</p>
    <input type="password" class="input_mp" id="input_mp" />
    <button class="create_account" type="button" onclick="open_popup_create_compte()">CrÃ©er</button>
    <button class="popup_se_connecter_button" onclick="sendName_connexion()">Suivant</button>
  </div>

  <!-- Popup crÃ©ation de compte -->
  <div class="popup_create_compte" id="popup_create_compte" style="display:none;">
    <button class="popup_create_compte_button" onclick="sendName_create()">CrÃ©er</button>
    <button class="ruturn_create_account" onclick="open_popup_se_connecter()">Retour</button>
    <h2 class="h2_create_account">CrÃ©er un compte</h2>
    <p class="inserez_id_create_account">InsÃ©rez un identifiant</p>
    <p class="inserez_mp_create_account">InsÃ©rez un mot de passe</p>
    <p class="confirm_mp_create_account">Confirmez le mot de passe</p>
    <input class="input_id_account" id="input_id_account" />
    <input type="password" class="input_mp_create_account" id="input_mp_create_account" />
    <input type="password" class="input_confirm_mp_create_account" id="input_confirm_mp_create_account"/>
    <p class="decors2">__</p>
  </div>

  <!-- Home -->
  <div class="Home" id="Home" style="display:none;">
    <h1 id="Welcome" class="Welcome">Welcome <span id="Welcome_nom"></span></h1>
    <div id="Home_div_left"><p></p></div>
  </div>

  <div class="popup_Moyen" id="popup_Moyen" style="display:none;">
    <button id="btn_calculer">Calculer ma moyenne</button>
    <div id="resultat_moyenne"></div>
  </div>

  <div id="popup_result"class="popup_result" style="display:none;"> <!-- Affichage cachÃ© par dÃ©faut -->
    <p id="result_message" class="result_message"></p> <!-- Attention, ne pas avoir deux Ã©lÃ©ments avec cet ID -->
    <button id="bFermeP1" class="bFermeP1" onclick="close_popup_result()">x</button>
  </div>

<script>
  // Variable nom
  var nom = "Axel";
  document.getElementById('Welcome_nom').textContent = nom;

  // Fonctions popup et affichages
  function open_popup_Moyen() {
    document.getElementById('Home').style.display = 'none';
    document.getElementById('popup_Moyen').style.display = 'block';
  }
  function close_popup_Moyen() {
    document.getElementById('popup_Moyen').style.display = 'none';
  }
  function open_popup_se_connecter() {
    document.getElementById('popup_create_compte').style.display = 'none';
    document.getElementById('popup_se_connecter').style.display = 'block';
    document.getElementById('overlay').style.display = 'block';
  }
  function close_popup_se_connecter() {
    document.getElementById('popup_se_connecter').style.display = 'none';
    document.getElementById('overlay').style.display = 'none';
  }
  function open_popup_result() {
  const popup = document.getElementById('popup_result');
  popup.style.display = 'flex';
  popup.style.zIndex = '99999';
  popup.style.position = 'fixed';
  popup.style.top = '10%';
  popup.style.left = '50%';
  popup.style.transform = 'translate(-50%, -50%)';
  popup.style.background = 'white';
  popup.style.padding = '30px';
  popup.style.borderRadius = '15px';
  popup.style.border = '2px solid black';
}


  function close_popup_result() {
    document.getElementById('popup_result').style.display = 'none';
    document.getElementById('overlay').style.display = 'none';
  }
  function open_popup_create_compte() {
    document.getElementById('popup_se_connecter').style.display = 'none';
    document.getElementById('popup_create_compte').style.display = 'block';
    document.getElementById('overlay').style.display = 'block';
  }
  function close_popup_create_compte() {
    document.getElementById('popup_create_compte').style.display = 'none';
    document.getElementById('overlay').style.display = 'none';
  }
  function open_div_Home() {
    document.getElementById('popup_se_connecter').style.display = 'none';
    document.getElementById('popup_create_compte').style.display = 'none';
    document.getElementById('Home').style.display = 'block';
    document.getElementById('overlay').style.display = 'none';
  }
  function close_div_Home() {
    document.getElementById('Home').style.display = 'none';
  }
  function closeAllPopups() {
    open_div_Home();
    close_popup_se_connecter();
    close_popup_create_compte();
    close_popup_Moyen();
  }

  async function sendName_connexion() {
  close_popup_se_connecter(); // Ferme la popup de connexion
  close_popup_create_compte();
  const name = document.getElementById('input_id').value;
  const mp = document.getElementById('input_mp').value;
  const action = 0;
  try {
    const response = await fetch('https://flask-api-1p4y.onrender.com/api/greet', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, mp, action})
    });

    const data = await response.json();

    const resultMessage = document.getElementById('result_message');
    resultMessage.innerText = data.message;

    // ðŸ‘‰ Afficher la popup SEULEMENT aprÃ¨s avoir reÃ§u le message
    open_popup_result();

  } catch (error) {
    const resultMessage = document.getElementById('result_message');
    resultMessage.innerText = 'Erreur lors de la connexion : ' + error.message;

    // ðŸ‘‰ Tu peux aussi ouvrir la popup ici pour montrer lâ€™erreur
    open_popup_result();
  }
}
async function sendName_create() {
  close_popup_se_connecter(); // Ferme la popup de connexion
  close_popup_create_compte();
  const name = document.getElementById('input_id_account').value;
  const firstMp = document.getElementById('input_mp_create_account').value;
  const secondMp = document.getElementById('input_confirm_mp_create_account').value;
  if firstMp != secoundMp {
    const resultMessage = document.getElementById('result_message');
    resultMessage.innerText = 'Les deux mot-de-passe sont differents';
    return 0;
  }
  const mp = firstMp
  const action = 1
  try {
    const response = await fetch('https://flask-api-1p4y.onrender.com/api/greet', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, mp, action})
    });

    const data = await response.json();

    const resultMessage = document.getElementById('result_message');
    resultMessage.innerText = data.message;

    // ðŸ‘‰ Afficher la popup SEULEMENT aprÃ¨s avoir reÃ§u le message
    open_popup_result();

  } catch (error) {
    const resultMessage = document.getElementById('result_message');
    resultMessage.innerText = 'Erreur lors de la connexion : ' + error.message;

    // ðŸ‘‰ Tu peux aussi ouvrir la popup ici pour montrer lâ€™erreur
    open_popup_result();
  }
}
const popup = document.getElementById('popup_result');

let isDragging = false;
let offsetY = 0;

popup.addEventListener('mousedown', function (e) {
  isDragging = true;
  offsetY = e.clientY - popup.getBoundingClientRect().top;
  popup.style.cursor = 'grabbing';
});

document.addEventListener('mousemove', function (e) {
  if (!isDragging) return;

  let newY = e.clientY - offsetY;

  // DÃ©placer le popup
  popup.style.top = newY + 'px';

  // Si on atteint le haut de la page, on le cache
  if (newY <= 0) {
    popup.style.opacity = '0';
    setTimeout(() => popup.style.display = 'none', 300);
    isDragging = false;
  }
});

document.addEventListener('mouseup', function () {
  isDragging = false;
  popup.style.cursor = 'grab';
});


  document.getElementById('overlay').addEventListener('click', closeAllPopups);
</script>
</body>
</html>
