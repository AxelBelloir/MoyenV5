<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Connexion Popup</title>
  <link rel="stylesheet" href="main.css" />
</head>
<body>
  <div class="Barre_task" >
    <button class="buton_se_connecter" onclick="open_popup_se_connecter()">Se connecter</button>
    <button class="Home_button" onclick="open_div_Home()">Home</button>
    <button class="buton_Moyen" onclick="open_popup_Moyen()">Moyen</button>
  </div>

  <!-- Overlay pour fond sombre -->
  <div id="overlay"></div>

  <!-- Fen√™tre popup connexion -->
  <div class="popup_se_connecter" id="popup_se_connecter" style="display:none;">
    <p class="decors1">__</p>
    <h2 class="h2_connexion">Connexion</h2>
    <p class="Inserez_votre_identifiants">Inserez votre identifiants</p>
    <input type="text" class="input_id" />
    <p class="Inserez_votre_mp">Inserez votre mot de passe</p>
    <input type="password" class="input_mp" />
    <button class="create_account" type="button" onclick="open_popup_create_compte()">Creer</button>
    <button class="popup_se_connecter_button" onclick="close_popup_se_connecter()">Suivant</button>
  </div>

  <!-- Popup cr√©ation de compte -->
  <div class="popup_create_compte" id="popup_create_compte" style="display:none;">
    <button class="popup_create_compte_button">Creer</button>
    <button class="ruturn_create_account" onclick="open_popup_se_connecter()">Retour</button>
    <h2 class="h2_create_account">Creer un compte</h2>
    <p class="inserez_id_create_account">Inserez un identifiants</p>
    <p class="inserez_mp_create_account">Inserez un mot de passe</p>
    <p class="confirm_mp_create_account">Confirmez le mot de passe</p>
    <input type="password"class="input_mp_create_account"/>
    <input type="text"class="input_confirm_mp_create_account"/>
    <input type="password" class="input_id_create_account"/>
    <p class="decors2">__</p>
  </div>

  <!-- Home -->
  <div class="Home" id="Home" style="display:none;">
    <h1 id="Welcome" class="Welcome">Welcome <span id="Welcome_nom"></span></h1>
    <div id="Home_div_left"><p></p></div>
  </div>
  <div class="popup_Moyen" id="popup_Moyen">
    <button id="btn_calculer">Calculer ma moyenne</button>
    <div id="resultat_moyenne"></div>
  </div>

  <script>
    // Variable nom
    var nom = "Axel";
    document.getElementById('Welcome_nom').textContent = nom;

    // Fonctions popup et affichages
    function open_popup_Moyen() {
      document.getElementById('Home').style.display = 'none';
      document.getElementById('popup_Moyen').style.display = 'block';
    }
    function close_popup_Moyen() {
      document.getElementById('popup_Moyen').style.display = 'none';
    }
    function open_popup_se_connecter() {
      document.getElementById('popup_create_compte').style.display = 'none';
      document.getElementById('popup_se_connecter').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
    }
    function close_popup_se_connecter() {
      document.getElementById('popup_se_connecter').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    }
    function open_popup_create_compte() {
      document.getElementById('popup_se_connecter').style.display = 'none';
      document.getElementById('popup_create_compte').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
    }
    function close_popup_create_compte() {
      document.getElementById('popup_create_compte').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    }
    function open_div_Home() {
      document.getElementById('popup_se_connecter').style.display = 'none';
      document.getElementById('popup_create_compte').style.display = 'none';
      document.getElementById('Home').style.display = 'block';
      document.getElementById('overlay').style.display = 'none';
    }
    function close_div_Home() {
      document.getElementById('Home').style.display = 'none';
    }
    function closeAllPopups() {
      open_div_Home();
      close_popup_se_connecter();
      close_popup_create_compte();
      close_popup_Moyen();
    }
document.getElementById('btn_calculer').addEventListener('click', async () => {
  const idUser = prompt("Identifiant √âcoleDirecte‚ÄØ:");
  const mdp = prompt("Mot de passe √âcoleDirecte‚ÄØ:");

  if (!idUser || !mdp) {
    alert("Identifiant ou mot de passe manquant !");
    return;
  }

  try {
    // √âtape 1 : R√©cup√©rer le token
    const respLogin = await fetch("https://api.ecoledirecte.com/v3/login.awp", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: `data=${encodeURIComponent(JSON.stringify({identifiant: idUser, motdepasse: mdp}))}`
    });
    const dataLogin = await respLogin.json();
    if (dataLogin.code !== 200) {
      throw new Error("Erreur connexion‚ÄØ: " + (dataLogin.message || "Identifiants incorrects"));
    }
    const token = dataLogin.token;
    const idAccount = dataLogin.data.accounts[0].id;

    // √âtape 2 : R√©cup√©rer les notes
    const respNotes = await fetch(`https://api.ecoledirecte.com/v3/eleves/${idAccount}/notes.awp?verbe=get`, {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
        "Authorization": token
      },
      body: "data=" + encodeURIComponent("{}")
    });
    const dataNotes = await respNotes.json();
    const notes = dataNotes.data.notes;

    // √âtape 3 : Calculer la moyenne
    let total = 0, coeffTotal = 0;
    notes.forEach(note => {
      const v = parseFloat(note.valeur.replace(",", "."));
      const coef = parseFloat(note.coefficient || 1);
      if (!isNaN(v) && !isNaN(coef)) {
        total += v * coef;
        coeffTotal += coef;
      }
    });
    const moyenne = coeffTotal ? (total / coeffTotal).toFixed(2) : null;

    // √âtape 4 : Afficher le r√©sultat
    document.getElementById('resultat-moyenne').innerText =
      moyenne ? `üìò Votre moyenne est ${moyenne}/20` : "Aucune note disponible.";

  } catch (e) {
    document.getElementById('resultat_moyenne').innerText = "‚ö†Ô∏è Erreur : " + e.message;
  }
});
  document.getElementById('overlay').addEventListener('click', closeAllPopups);
</script>
</body>
</html>
