<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Connexion Popup</title>
  <link rel="stylesheet" href="main.css" />
</head>
<body>
  <button class="buton_se_connecter" onclick="open_popup_se_connecter()">Se connecter</button>
  <div class="Barre_task" style="display:none;">
    <button class="Home_button" onclick="open_div_Home()">Home</button>
    <button class="buton_Moyen" onclick="open_popup_Moyen()">Moyen</button>
  </div>

  <!-- Overlay pour fond sombre -->
  <div id="overlay"></div>

  <!-- Fen√™tre popup connexion -->
  <div class="popup_se_connecter" id="popup_se_connecter" style="display:none;">
    <p class="decors1">__</p>
    <h2 class="h2_connexion">Connexion</h2>
    <p class="Inserez_votre_identifiants">Ins√©rez votre identifiant</p>
    <input type="text" class="input_id" id="input_id" />
    <p class="Inserez_votre_mp">Ins√©rez votre mot de passe</p>
    <input type="password" class="input_mp" id="input_mp" />
    <button class="create_account" type="button" onclick="open_popup_create_compte()">Cr√©er</button>
    <button class="popup_se_connecter_button" onclick="sendName()">Suivant</button>
  </div>

  <!-- Popup cr√©ation de compte -->
  <div class="popup_create_compte" id="popup_create_compte" style="display:none;">
    <button class="popup_create_compte_button">Cr√©er</button>
    <button class="ruturn_create_account" onclick="open_popup_se_connecter()">Retour</button>
    <h2 class="h2_create_account">Cr√©er un compte</h2>
    <p class="inserez_id_create_account">Ins√©rez un identifiant</p>
    <p class="inserez_mp_create_account">Ins√©rez un mot de passe</p>
    <p class="confirm_mp_create_account">Confirmez le mot de passe</p>
    <input type="password" class="input_mp_create_account" />
    <input type="text" class="input_confirm_mp_create_account" />
    <input type="password" class="input_id_create_account" />
    <p class="decors2">__</p>
  </div>

  <!-- Home -->
  <div class="Home" id="Home" style="display:none;">
    <h1 id="Welcome" class="Welcome">Welcome <span id="Welcome_nom"></span></h1>
    <div id="Home_div_left"><p></p></div>
  </div>

  <div class="popup_Moyen" id="popup_Moyen" style="display:none;">
    <button id="btn_calculer">Calculer ma moyenne</button>
    <div id="resultat_moyenne"></div>
  </div>

  <div id="popup_result"class="popup_result" style="display:none;"> <!-- Affichage cach√© par d√©faut -->
    <p id="result_message" class="result_message"></p> <!-- Attention, ne pas avoir deux √©l√©ments avec cet ID -->
  </div>

<script>
  // Variable nom
  var nom = "Axel";
  document.getElementById('Welcome_nom').textContent = nom;

  // Fonctions popup et affichages
  function open_popup_Moyen() {
    document.getElementById('Home').style.display = 'none';
    document.getElementById('popup_Moyen').style.display = 'block';
  }
  function close_popup_Moyen() {
    document.getElementById('popup_Moyen').style.display = 'none';
  }
  function open_popup_se_connecter() {
    document.getElementById('popup_create_compte').style.display = 'none';
    document.getElementById('popup_se_connecter').style.display = 'block';
    document.getElementById('overlay').style.display = 'block';
  }
  function close_popup_se_connecter() {
    document.getElementById('popup_se_connecter').style.display = 'none';
    document.getElementById('overlay').style.display = 'none';
  }
  function open_popup_result() {
    document.getElementById('popup_result').style.display = 'block';
    document.getElementById('overlay').style.display = 'block';
  }
  function close_popup_result() {
    document.getElementById('popup_result').style.display = 'none';
    document.getElementById('overlay').style.display = 'none';
  }
  function open_popup_create_compte() {
    document.getElementById('popup_se_connecter').style.display = 'none';
    document.getElementById('popup_create_compte').style.display = 'block';
    document.getElementById('overlay').style.display = 'block';
  }
  function close_popup_create_compte() {
    document.getElementById('popup_create_compte').style.display = 'none';
    document.getElementById('overlay').style.display = 'none';
  }
  function open_div_Home() {
    document.getElementById('popup_se_connecter').style.display = 'none';
    document.getElementById('popup_create_compte').style.display = 'none';
    document.getElementById('Home').style.display = 'block';
    document.getElementById('overlay').style.display = 'none';
  }
  function close_div_Home() {
    document.getElementById('Home').style.display = 'none';
  }
  function closeAllPopups() {
    open_div_Home();
    close_popup_se_connecter();
    close_popup_create_compte();
    close_popup_Moyen();
    close_popup_result();
  }

  async function sendName() {
  close_popup_se_connecter();
  open_popup_result();

  const name = document.getElementById('input_id').value;
  const mp = document.getElementById('input_mp').value;

  try {
    const response = await fetch('https://flask-api-1p4y.onrender.com/api/greet', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, mp })
    });

    const data = await response.json();

    const resultMessage = document.getElementById('result_message');
    resultMessage.innerText = data.message;

    // üîç Debug visuel
    const debugText = `
--- DEBUG ---
display (popup_result): ${getComputedStyle(document.getElementById('popup_result')).display}
position (result_message): ${getComputedStyle(resultMessage).position}
contenu message : ${data.message || 'vide'}
----------------
    `;
    resultMessage.innerText += "\n\n" + debugText;

  } catch (error) {
    document.getElementById('result_message').innerText = "Erreur r√©seau : " + error.message;
  }
}


  document.getElementById('overlay').addEventListener('click', closeAllPopups);
</script>
</body>
</html>
